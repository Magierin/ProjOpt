import connection as con
import distance as dis
import get_predicted_duration_new as gpd
import csv_to_matrix as ctm
import quantity as quan
import test

ls = [94,209,210,522,344,222,223,329,305,517 ,350 ,481 ,524 ,189 ,190 ,495 ,226,453 ,124 ,125 ,429 ,426 ,375 ,271 ,272 ,274,441,332,234,15,516, 22,364, 276,76,428,442,508,230 ,229 ,417,430 ,418 ,409 ,313 ,312 ,275 ,173 ,174 ,284 ,335 ,386 ,301 ,405 ,161 ,162]
new_ls = ['94', '209', '210', '522', '344', '222', '223', '329', '305', '517', '350', '481', '524', '189', '190', '495', '226', '453', '124', '125', '429', '426', '375', '271', '272', '274', '441', '332', '234', '15', '516', '22', '364', '276', '76', '428', '508', '230', '229', '417', '430', '418', '409', '313', '312', '275', '173', '174', '284', '335', '386', '301', '405', '161', '162']
new_ls1 = ['94', '209', '210', '522', '344', '222', '223', '329', '305', '517', '350', '481', '524', '189', '190', '495', '226', '453', '124', '125', '429', '426', '375', '271', '272', '274', '441', '332', '234', '15', '516', '22', '364', '276', '76', '428', '442', '508', '230', '229', '417', '430', '418', '409', '313', '312', '275', '173', '174', '284', '335', '386', '301', '405', '161', '162']
new_ls2 = ['94', '209', '210', '522', '344', '222', '223', '329', '305', '517', '350', '481', '524', '189', '190', '495', '226', '453', '124', '125', '429', '426', '375', '271', '272', '274', '441', '332', '234', '15', '516', '22', '364', '276', '76', '428', '508', '230', '229', '417', '430', '418', '409', '313', '312', '275', '173', '174', '284', '335', '386', '301', '405', '161', '162']
new_ls3 = ['94', '209', '210', '522', '344', '222', '223', '329', '305', '517', '136', '444', '270', '213', '214', '520', '482', '496', '431', '497', '535', '441', '332', '234', '15', '516', '22', '364', '276', '76', '428', '508', '230', '229', '417', '430', '418', '409', '313', '312', '275', '173', '174', '284', '335', '386', '301', '405', '161', '162']
new_ls4 = ['94', '209', '210', '522', '344', '222', '223', '329', '305', '517', '136', '444', '270', '213', '214', '520', '482', '496', '431', '497', '535', '441', '332', '234', '15', '516', '22', '364', '276', '76', '428', '508', '230', '229', '417', '430', '418', '409', '313', '312', '275', '173', '174', '284', '335', '386', '301', '405', '161', '162']
new_ls5 = ['94', '209', '210', '522', '344', '222', '223', '329', '305', '517', '136', '444', '270', '213', '214', '520', '482', '496', '431', '497', '535', '441', '332', '234', '15', '516', '22', '364', '276', '76', '428', '508', '230', '229', '417', '430', '418', '409', '313', '312', '275', '173', '174', '284', '335', '386', '301', '405', '161', '162']
new_ls6 = ['94', '209', '210', '522', '344', '222', '223', '329', '305', '517', '136', '444', '270', '213', '214', '520', '482', '511', '407', '532', '113', '531', '534', '537', '536', '516', '22', '364', '276', '76', '428', '508', '230', '229', '417', '430', '418', '409', '313', '312', '275', '173', '174', '284', '335', '386', '301', '405', '161', '162']
als = ['94', '209', '210', '522', '344', '222', '223', '329', '305', '517', '350', '481', '524', '189', '190', '495', '226', '453', '124', '125', '429', '426', '375', '271', '272', '274', '441', '332', '234', '15', '516', '22', '364', '276', '76', '428', '442', '508', '230', '229', '417', '430', '418', '409', '313', '312', '275', '173', '174', '284', '335', '386', '301', '405', '161', '162']
als1 = ['94', '209', '210', '522', '344', '222', '223', '329', '305', '517', '350', '481', '524', '189', '190', '495', '226', '453', '124', '125', '429', '426', '375', '271', '272', '274', '441', '332', '234', '15', '516', '22', '364', '276', '76', '428', '508', '230', '229', '417', '430', '418', '409', '313', '312', '275', '173', '174', '284', '335', '386', '301', '405', '161', '162']
new_ls7 = ['94', '209', '210', '522', '344', '222', '223', '329', '305', '517', '136', '444', '270', '213', '214', '520', '482', '496', '431', '497', '535', '441', '332', '234', '15', '516', '364', '276', '76', '428', '508', '230', '229', '417', '430', '418', '409', '313', '312', '275', '173', '174', '284', '335', '386', '301', '405', '161', '162']
als_1 = ['94', '209', '210', '522', '344', '222', '223', '329', '305', '517', '350', '481', '524', '189', '190', '495', '226', '453', '124', '125', '429', '426', '375', '271', '272', '274', '441', '332', '234', '15', '516', '22', '364', '276', '76', '428', '442', '508', '230', '229', '417', '430', '418', '409', '313', '312', '275', '173', '174', '284', '335', '386', '301', '405', '161', '162']
als_56 = ['94', '209', '210', '522', '344', '222', '223', '329', '305', '517', '350', '481', '524', '189', '190', '495', '226', '453', '124', '125', '429', '426', '375', '271', '272', '274', '441', '332', '234', '15', '516', '22', '364', '276', '76', '428', '508', '230', '229', '417', '430', '418', '409', '313', '312', '275', '173', '174', '284', '335', '386', '301', '405', '161', '162']



def get_route_duration():
    data = gpd.get_edges_predicted_duration_new(1)
    summe = 0
    for i in range(len(ls)-1):
        dic = con.get_connection(str(ls[i]), str(ls[i+1]))
        num = dic.get("number")
        summe += float(data[int(num)])
    t = float(round((round(summe, 2) - int(round(summe, 2))) * 60)) / 100 + int(round(summe, 2))
    return t


def get_routes_quantity():
    route, route_freq, k = [el[:-3] for el in ctm.csv_to_matrix('route-all.csv')], [], 0

    for i in range(len(route)):
        if route[i] not in route_freq:
            route_freq.append(route[i])

    return route_freq



ls_005 = ['94', '209', '210', '522', '344', '222', '223', '329', '305', '517', '136', '444', '270', '213', '214', '520', '482', '511', '407', '532', '13', '530', '443', '452', '172', '438', '528', '515', '372', '442', '508', '230', '229', '417', '430', '418', '409', '313', '312', '275', '173', '174', '284', '335', '386', '301', '405', '161', '162']
ls_005 = ['94', '209', '210', '522', '344', '222', '223', '329', '305', '517', '136', '444', '270', '213', '214', '520', '482', '511', '407', '532', '13', '530', '443', '452', '172', '438', '528', '445', '442', '508', '230', '229', '417', '430', '418', '409', '313', '312', '275', '173', '174', '284', '335', '386', '301', '405', '161', '162']


ls_000 = ['94', '209', '210', '522', '344', '222', '223', '329', '305', '517', '136', '444', '270', '213', '214', '520', '482', '511', '407', '532', '13', '530', '443', '452', '172', '438', '528', '515', '372', '442', '508', '230', '229', '417', '430', '418', '409', '313', '312', '275', '173', '174', '284', '335', '386', '301', '405', '161', '162']
ls_000 = ['94', '209', '210', '522', '344', '222', '223', '329', '305', '517', '136', '444', '270', '213', '214', '520', '482', '511', '407', '532', '13', '530', '443', '452', '172', '438', '528', '445', '442', '508', '230', '229', '417', '430', '418', '409', '313', '312', '275', '173', '174', '284', '335', '386', '301', '405', '161', '162']


ls_020 = ['94', '209', '210', '522', '344', '222', '223', '329', '305', '517', '136', '444', '270', '213', '214', '520', '482', '511', '407', '532', '13', '530', '443', '452', '172', '438', '528', '445', '442', '508', '230', '229', '417', '430', '418', '409', '313', '312', '275', '173', '174', '284', '335', '386', '301', '405', '161', '162']
ls_020 = ['94', '209', '210', '522', '344', '222', '223', '329', '305', '517', '136', '444', '270', '213', '214', '520', '482', '511', '407', '532', '113', '531', '534', '537', '536', '516', '22', '364', '276', '76', '428', '508', '230', '229', '417', '430', '418', '409', '313', '312', '275', '173', '174', '284', '335', '386', '301', '405', '161', '162']


ls_040 = ['94', '209', '210', '522', '344', '222', '223', '329', '305', '517', '136', '444', '270', '213', '214', '520', '482', '511', '407', '532', '13', '530', '443', '452', '172', '438', '528', '445', '442', '508', '230', '229', '417', '430', '418', '409', '313', '312', '275', '173', '174', '284', '335', '386', '301', '405', '161', '162']
ls_040 = ['94', '209', '210', '522', '344', '222', '223', '329', '305', '517', '136', '444', '270', '213', '214', '520', '482', '496', '511', '407', '532', '113', '531', '534', '537', '536', '516', '22', '364', '276', '76', '428', '442', '508', '230', '229', '417', '430', '418', '409', '313', '312', '275', '173', '174', '284', '335', '386', '301', '405', '161', '162']


ls_0 = ['94', '209', '210', '522', '344', '222', '223', '329', '305', '517', '350', '481', '524', '100', '99', '456', '98', '455', '496', '511', '407', '532', '13', '530', '443', '452', '172', '438', '528', '515', '372', '442', '508', '230', '229', '417', '430', '418', '409', '313', '312', '275', '173', '174', '284', '335', '386', '301', '405', '161', '162']
ls_0 = ['94', '209', '210', '522', '344', '222', '223', '329', '305', '517', '350', '481', '524', '100', '99', '456', '347', '250', '520', '482', '496', '511', '407', '532', '13', '530', '443', '452', '172', '438', '528', '515', '372', '442', '508', '230', '229', '417', '430', '418', '409', '313', '312', '275', '173', '174', '284', '335', '386', '301', '405', '161', '162']
ls_0 = ['94', '209', '210', '522', '344', '222', '223', '329', '305', '517', '350', '481', '524', '100', '99', '456', '347', '250', '520', '482', '496', '511', '407', '532', '13', '530', '443', '452', '172', '438', '528', '515', '372', '442', '508', '230', '229', '417', '430', '418', '409', '313', '312', '275', '173', '174', '284', '335', '386', '301', '405', '161', '162']

ls_0 = ['94', '209', '210', '522', '344', '222', '223', '329', '305', '517', '350', '481', '524', '100', '99', '456', '98', '455', '496', '511', '407', '532', '13', '530', '443', '452', '172', '438', '528', '445', '442', '508', '230', '229', '417', '430', '418', '409', '313', '312', '275', '173', '174', '284', '335', '386', '301', '405', '161', '162']
ls_0 = ['94', '209', '210', '522', '344', '222', '223', '329', '305', '517', '350', '481', '524', '100', '99', '456', '347', '250', '520', '482', '511', '407', '532', '113', '531', '534', '537', '536', '516', '22', '364', '276', '76', '428', '442', '508', '230', '229', '417', '430', '418', '409', '313', '312', '275', '173', '174', '284', '335', '386', '301', '405', '161', '162']

ls_0 = ['94', '209', '210', '522', '344', '222', '223', '329', '305', '517', '350', '481', '524', '100', '99', '456', '98', '455', '496', '511', '407', '532', '13', '530', '443', '452', '172', '438', '528', '445', '442', '508', '230', '229', '417', '430', '418', '409', '313', '312', '275', '173', '174', '284', '335', '386', '301', '405', '161', '162']
ls_0 = ['94', '209', '210', '522', '344', '222', '223', '329', '305', '517', '350', '481', '524', '100', '99', '456', '347', '250', '520', '482', '496', '511', '407', '532', '113', '531', '534', '537', '536', '516', '22', '364', '276', '76', '428', '442', '508', '230', '229', '417', '430', '418', '409', '313', '312', '275', '173', '174', '284', '335', '386', '301', '405', '161', '162']

ls_0 = ['94', '209', '210', '522', '344', '222', '223', '329', '305', '517', '350', '481', '524', '100', '99', '456', '98', '455', '496', '511', '407', '532', '13', '530', '443', '452', '172', '438', '528', '445', '442', '508', '230', '229', '417', '430', '418', '409', '313', '312', '275', '173', '174', '284', '335', '386', '301', '405', '161', '162']
ls_0 = ['94', '209', '210', '522', '344', '222', '223', '329', '305', '517', '350', '481', '524', '100', '99', '456', '347', '250', '520', '482', '511', '407', '532', '113', '531', '534', '537', '536', '516', '22', '364', '276', '76', '428', '442', '508', '230', '229', '417', '430', '418', '409', '313', '312', '275', '173', '174', '284', '335', '386', '301', '405', '161', '162']

ls_0 = ['94', '209', '210', '522', '344', '222', '223', '329', '305', '517', '350', '481', '524', '100', '99', '456', '98', '455', '496', '511', '407', '532', '13', '530', '443', '452', '172', '438', '528', '445', '442', '508', '230', '229', '417', '430', '418', '409', '313', '312', '275', '173', '174', '284', '335', '386', '301', '405', '161', '162']
ls_0 = ['94', '209', '210', '522', '344', '222', '223', '329', '305', '517', '350', '481', '524', '100', '99', '456', '347', '250', '520', '482', '496', '511', '407', '532', '13', '530', '443', '452', '172', '438', '528', '515', '372', '442', '508', '230', '229', '417', '430', '418', '409', '313', '312', '275', '173', '174', '284', '335', '386', '301', '405', '161', '162']

ls_0 = ['94', '209', '210', '522', '344', '222', '223', '329', '305', '517', '350', '481', '524', '100', '99', '456', '98', '455', '496', '511', '407', '532', '13', '530', '443', '452', '172', '438', '528', '515', '372', '442', '508', '230', '229', '417', '430', '418', '409', '313', '312', '275', '173', '174', '284', '335', '386', '301', '405', '161', '162']
ls_0 = ['94', '209', '210', '522', '344', '222', '223', '329', '305', '517', '350', '481', '524', '100', '99', '456', '347', '250', '520', '482', '496', '511', '407', '532', '13', '530', '443', '452', '172', '438', '528', '515', '372', '442', '508', '230', '229', '417', '430', '418', '409', '313', '312', '275', '173', '174', '284', '335', '386', '301', '405', '161', '162']

ls_0 = ['94', '209', '210', '522', '344', '222', '223', '329', '305', '517', '136', '444', '270', '213', '214', '520', '482', '511', '407', '532', '13', '530', '443', '452', '172', '438', '528', '445', '442', '508', '230', '229', '417', '430', '418', '409', '313', '312', '275', '173', '174', '284', '335', '386', '301', '405', '161', '162']

ls_0 = ['94', '209', '210', '522', '344', '222', '223', '329', '305', '517', '136', '444', '270', '213', '214', '520', '482', '511', '407', '532', '13', '530', '443', '452', '172', '438', '528', '445', '442', '508', '230', '229', '417', '430', '418', '409', '313', '312', '275', '173', '174', '284', '335', '386', '301', '405', '161', '162']
ls_0 = ['94', '209', '210', '522', '344', '222', '223', '329', '305', '517', '136', '444', '270', '213', '214', '520', '482', '511', '407', '532', '13', '530', '443', '452', '172', '438', '528', '445', '442', '508', '230', '229', '417', '430', '418', '409', '313', '312', '275', '173', '174', '284', '335', '386', '301', '405', '161', '162']

ls_0 = ['94', '209', '210', '522', '344', '222', '223', '329', '305', '517', '350', '481', '524', '100', '99', '456', '98', '455', '496', '511', '407', '532', '13', '530', '443', '452', '172', '438', '528', '515', '372', '442', '508', '230', '229', '417', '430', '418', '409', '313', '312', '275', '173', '174', '284', '335', '386', '301', '405', '161', '162']
#ls_0 = ['94', '209', '210', '522', '344', '222', '223', '329', '305', '517', '350', '481', '524', '100', '99', '456', '347', '250', '520', '482', '496', '511', '407', '532', '13', '530', '443', '452', '172', '438', '528', '515', '372', '442', '508', '230', '229', '417', '430', '418', '409', '313', '312', '275', '173', '174', '284', '335', '386', '301', '405', '161', '162']
ls_0 = ['94', '209', '210', '522', '344', '222', '223', '329', '305', '517', '350', '481', '524', '100', '99', '456', '347', '250', '520', '482', '496', '511', '407', '532', '13', '530', '443', '452', '172', '438', '528', '515', '372', '442', '508', '230', '229', '417', '430', '418', '409', '313', '312', '275', '173', '174', '284', '335', '386', '301', '405', '161', '162']


# untersucht, ob die gefundene Route auch historisch ist
ls1 = [str(x) for x in ls_0]
if ls1 in get_routes_quantity():
    ind = get_routes_quantity().index(ls1)
    print(quan.get_routes_quantity()[ind])


# Ähnlichkeit der Routen von den Algorithmen zu den historischen
ls_0 = ['94', '209', '210', '522', '344', '222', '223', '329', '305', '517', '350', '481', '524', '189', '190', '495', '226', '453', '124', '125', '429', '426', '375', '271', '272', '274', '441', '332', '234', '15', '516', '22', '364', '276', '76', '14', '372', '442', '508', '230', '229', '417', '430', '418', '409', '313', '312', '275', '173', '174', '284', '335', '386', '301', '405', '161', '162']
ls_0 = ['94', '209', '210', '522', '344', '222', '223', '329', '305', '517', '136', '444', '270', '213', '214', '520', '482', '511', '407', '532', '13', '530', '443', '452', '172', '438', '528', '445', '442', '508', '230', '229', '417', '430', '418', '409', '313', '312', '275', '173', '174', '284', '335', '386', '301', '405', '161', '162']
ls_0 = ['94', '209', '210', '522', '344', '222', '223', '329', '305', '517', '350', '481', '524', '189', '190', '495', '226', '453', '124', '125', '429', '426', '375', '271', '272', '274', '441', '332', '234', '15', '516', '22', '364', '276', '76', '428', '442', '508', '230', '229', '417', '430', '418', '409', '313', '312', '275', '173', '174', '284', '335', '386', '301', '405', '161', '162']
ls_0 = ['94', '209', '210', '522', '344', '222', '223', '329', '305', '517', '136', '444', '270', '213', '214', '520', '482', '496', '431', '497', '535', '441', '332', '234', '15', '516', '22', '364', '276', '76', '428', '442', '508', '230', '229', '417', '430', '418', '409', '313', '312', '275', '173', '174', '284', '335', '386', '301', '405', '161', '162']
ls_0 = ['94', '209', '210', '522', '344', '222', '223', '329', '305', '517', '350', '481', '524', '189', '190', '495', '226', '453', '124', '125', '429', '426', '375', '271', '272', '274', '441', '332', '234', '15', '516', '22', '364', '276', '76', '428', '442', '508', '230', '229', '417', '430', '418', '409', '313', '312', '275', '173', '174', '284', '335', '386', '301', '405', '161', '162']
ls_0 = ['94', '209', '210', '522', '344', '222', '223', '329', '305', '517', '350', '481', '524', '189', '190', '495', '226', '453', '124', '125', '429', '426', '375', '271', '272', '274', '441', '332', '234', '15', '516', '22', '364', '276', '76', '14', '372', '442', '508', '230', '229', '417', '430', '418', '409', '313', '312', '275', '173', '174', '284', '335', '386', '301', '405', '161', '162']


def get_route_duration(ls_0):
    data = gpd.get_edges_predicted_duration_new(1)
    summe = 0
    for i in range(len(ls)-1):
        dic = con.get_connection(str(ls[i]), str(ls_0[i+1]))
        num = dic.get("number")
        summe += float(data[int(num)])
    t = float(round((round(summe, 2) - int(round(summe, 2))) * 60)) / 100 + int(round(summe, 2))
    return t

counter = 0
summe = 0
for route in quan.get_routes_quantity_per_hour()[0]:
    dup = [x for x in ls_0 if x in route]
    #print(dup)
    #print(len(dup)/len(ls_0))
    summe += len(dup)/len(ls_0)
    if len(dup)/len(ls_0) >= 0.75:
        print(len(dup)/len(ls_0))
        print(route)
        counter += 1
print(counter)
print(len(quan.get_routes_quantity_per_hour()[0]))
print(counter/len(quan.get_routes_quantity_per_hour()[0]))
print(summe)
print(summe/len(quan.get_routes_quantity_per_hour()[0]))


# Ähnlichkeit zur echten historischen Route
ls = ctm.csv_to_matrix('route-all.csv')[0][:-3]
#print(ls)
#print(ls_0)
dup = [x for x in ls_0 if x in ls]
sim = len(dup)/len(ls)
print(sim)


def similar(ls_0, hour):
    counter = 0
    summe = 0
    for route in test.get_timestamp_route_list(hour):
        dup = [x for x in ls_0 if x in route]
        summe += len(dup)/len(ls_0)
        if len(dup)/len(ls_0) >= 0.75:
            counter += 1
    return counter/len(test.get_timestamp_route_list(hour))

print(similar(['94', '209', '210', '522', '344', '222', '223', '329', '305', '517', '350', '481', '524', '100', '99', '456', '347', '250', '520', '482', '496', '511', '407', '532', '13', '530', '443', '452', '172', '438', '528', '515', '372', '442', '508', '230', '229', '417', '430', '418', '409', '313', '312', '275', '173', '174', '284', '335', '386', '301', '405', '161', '162'], '28 Mr 00_09_46'))


